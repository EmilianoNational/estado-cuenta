<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Captura de Página HTML a PDF</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>

</head>

<body>
    <button id="captureButton">Capturar y Generar PDF</button>

    <script>
        //async function generarPdf (){
        document.getElementById("captureButton").addEventListener("click", async function () {

            console.log("capturando");
            
            // URL de la página externa a capturar
            var externalPageUrl = "conceptos.html";

            // Crear un iframe oculto para cargar la página externa
            var iframe = document.createElement('iframe');
            iframe.id = 'iframe';
            //iframe.style.display = 'visible';
            iframe.src = externalPageUrl;
            //console.log('iframe creado')
            document.body.appendChild(iframe);
            //console.log('iframe content window: ' + iframe.contentWindow)

            // Esperar a que se cargue la página en el iframe
            iframe.onload = async function () {
                //console.log('entramos a la función')
                
                const margin = 40;
                // Capturar el contenido del iframe
                const canvas = await html2canvas(iframe.contentWindow.document.body, {scale: 1});
                //console.log('capturamos el canvas')
                // Crear un PDF
                const pdf = new jsPDF('p', 'pt', [canvas.width, canvas.height]);
                const img = canvas.toDataURL("image/png");
                const imgProperties = pdf.getImageProperties(img);
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (imgProperties.height * pdfWidth) / imgProperties.width;
                //console.log('generamos el pdf')
                // Agregar la imagen capturada al PDF
                //pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, canvas.width, canvas.height);
                pdf.addImage(img, "PNG", margin, margin, pdfWidth - 2 * margin, pdfHeight - 2 * margin);
                //console.log('agregamos la imagen al pdf')
                // Descargar el PDF
                pdf.save('download.pdf');
                //console.log('guardamos el pdf')
                // Eliminar el iframe
                document.body.removeChild(iframe);
            };
        });
    </script>
</body>

</html>